<!DOCTYPE html>
<!-- saved from url=(0084)https://www.w3.org/TR/wai-aria-practices/examples/listbox/listbox-rearrangeable.html -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>Listbox</title>

    <link href="./listAdd_files/listbox.css" rel="stylesheet">
    <script src="./listAdd_files/listbox-rearrangeable.js.download" type="text/javascript"></script>
    </style>
</head>

<body>
    <main>
        <section>
            <section>
                <div role="separator" id="ex2_start_sep" aria-labelledby="ex2_start_sep ex2_label" aria-label="Start of"></div>
                <div id="ex2">
                    <div class="listbox-area">
                        <div class="left-area">
                            <span id="ms_av_l" class="listbox-label">Available upgrades:</span>
                            <ul id="ms_imp_list" tabindex="0" role="listbox" aria-labelledby="ms_av_l" aria-multiselectable="true" aria-activedescendant="null">
                                <li id="ms_opt7" role="option" aria-selected="false">Cloaking capability</li>
                                <li id="ms_opt8" role="option" aria-selected="false">Food synthesizer</li>
                                <li id="ms_opt9" role="option" aria-selected="false">Advanced waste recycling system</li>
                                <li id="ms_opt10" role="option" aria-selected="false">Turbo vertical take-off capability</li>
                            </ul>
                            <button type="button" id="ex2-add" class="move-right-btn" aria-keyshortcuts="Alt+ArrowRight Enter" aria-disabled="false">Add</button>
                        </div>
                        <div class="right-area">
                            <span id="ms_ch_l" class="listbox-label">Upgrades you have chosen:</span>
                            <ul id="ms_unimp_list" tabindex="0" role="listbox" aria-labelledby="ms_ch_l" aria-activedescendant="ms_opt1" aria-multiselectable="true">
                                <li id="ms_opt1" role="option" aria-selected="false" class="focused">Leather seats</li>
                                <li id="ms_opt4" role="option" aria-selected="false" class="">Rear seat warmers</li>
                                <li id="ms_opt6" role="option" aria-selected="false" class="">Rear sun roof</li>
                                <li id="ms_opt2" role="option" aria-selected="false" class="">Front seat warmers</li>
                                <li id="ms_opt3" role="option" aria-selected="false" class="">Rear bucket seats</li>
                                <li id="ms_opt5" role="option" aria-selected="false" class="">Front sun roof</li>
                            </ul>
                            <button type="button" id="ex2-delete" class="move-left-btn" aria-keyshortcuts="Alt+ArrowLeft Delete" aria-disabled="true">Remove</button>
                        </div>
                        <div class="offscreen">Last change: <span aria-live="polite" id="ms_live_region">Added 3 items to chosen features.</span></div>
                    </div>
                </div>
                <div role="separator" id="ex2_end_sep" aria-labelledby="ex2_end_sep ex2_label" aria-label="End of"></div>
                </ol>
            </section>
        </section>
    </main>



    <script type="text/javascript">
        'use strict';

        /**
         * @namespace aria
         */
        var aria = aria || {};

        /**
         * @class
         * @description
         *  Listbox object representing the state and interactions for a listbox widget
         * @param listboxNode
         *  The DOM node pointing to the listbox
         */
        aria.Listbox = function(listboxNode) {
            this.listboxNode = listboxNode;
            this.activeDescendant = this.listboxNode.getAttribute(
                'aria-activedescendant'
            );
            this.multiselectable = this.listboxNode.hasAttribute('aria-multiselectable');
            this.moveUpDownEnabled = false;
            this.siblingList = null;
            this.startRangeIndex = 0;
            this.upButton = null;
            this.downButton = null;
            this.moveButton = null;
            this.keysSoFar = '';
            this.handleFocusChange = function() {};
            this.handleItemChange = function() {};
            this.registerEvents();
        };

        /**
         * @description
         *  Register events for the listbox interactions
         */
        aria.Listbox.prototype.registerEvents = function() {
            this.listboxNode.addEventListener('focus', this.setupFocus.bind(this));
            this.listboxNode.addEventListener('keydown', this.checkKeyPress.bind(this));
            this.listboxNode.addEventListener('click', this.checkClickItem.bind(this));

            if (this.multiselectable) {
                this.listboxNode.addEventListener(
                    'mousedown',
                    this.checkMouseDown.bind(this)
                );
            }
        };

        /**
         * @description
         *  If there is no activeDescendant, focus on the first option
         */
        aria.Listbox.prototype.setupFocus = function() {
            if (this.activeDescendant) {
                return;
            }
        };

        /**
         * @description
         *  Focus on the first option
         */
        aria.Listbox.prototype.focusFirstItem = function() {
            var firstItem = this.listboxNode.querySelector('[role="option"]');

            if (firstItem) {
                this.focusItem(firstItem);
            }
        };

        aria.Listbox.prototype.checkKeyPress = function(evt) {};

        aria.Listbox.prototype.findItemToFocus = function(key) {};

        /* Return the index of the passed element within the passed array, or null if not found */
        aria.Listbox.prototype.getElementIndex = function(option, options) {};

        /* Return the next listbox option, if it exists; otherwise, returns null */
        aria.Listbox.prototype.findNextOption = function(currentOption) {};

        /* Return the previous listbox option, if it exists; otherwise, returns null */
        aria.Listbox.prototype.findPreviousOption = function(currentOption) {};

        aria.Listbox.prototype.clearKeysSoFarAfterDelay = function() {};

        aria.Listbox.prototype.findMatchInRange = function() {};

        /**
         * @description
         *  Check if an item is clicked on. If so, focus on it and select it.
         * @param evt
         *  The click event object
         */
        aria.Listbox.prototype.checkClickItem = function(evt) {
            if (evt.target.getAttribute('role') !== 'option') {
                return;
            }

            this.focusItem(evt.target);
            this.toggleSelectItem(evt.target);
            this.updateScroll();

            if (this.multiselectable && evt.shiftKey) {
                this.selectRange(this.startRangeIndex, evt.target);
            }
        };

        /**
         * Prevent text selection on shift + click for multi-select listboxes
         *
         * @param evt
         */
        aria.Listbox.prototype.checkMouseDown = function(evt) {};

        /**
         * @description
         *  Toggle the aria-selected value
         * @param element
         *  The element to select
         */
        aria.Listbox.prototype.toggleSelectItem = function(element) {
            if (this.multiselectable) {
                element.setAttribute(
                    'aria-selected',
                    element.getAttribute('aria-selected') === 'true' ? 'false' : 'true'
                );

                this.updateMoveButton();
            }
        };

        /**
         * @description
         *  Defocus the specified item
         * @param element
         *  The element to defocus
         */
        aria.Listbox.prototype.defocusItem = function(element) {
            if (!element) {
                return;
            }
            element.classList.remove('focused');
        };

        /**
         * @description
         *  Focus on the specified item
         * @param element
         *  The element to focus
         */
        aria.Listbox.prototype.focusItem = function(element) {
            this.defocusItem(document.getElementById(this.activeDescendant));

            element.classList.add('focused');
            this.listboxNode.setAttribute('aria-activedescendant', element.id);
            this.activeDescendant = element.id;

            if (!this.multiselectable) {
                this.updateMoveButton();
            }


        };

        /**
         * Helper function to check if a number is within a range; no side effects.
         *
         * @param index
         * @param start
         * @param end
         * @returns {boolean}
         */
        aria.Listbox.prototype.checkInRange = function(index, start, end) {
            var rangeStart = start < end ? start : end;
            var rangeEnd = start < end ? end : start;

            return index >= rangeStart && index <= rangeEnd;
        };

        /**
         * Select a range of options
         *
         * @param start
         * @param end
         */
        aria.Listbox.prototype.selectRange = function(start, end) {
            // get start/end indices
            var allOptions = this.listboxNode.querySelectorAll('[role="option"]');
            var startIndex =
                typeof start === 'number' ? start : this.getElementIndex(start, allOptions);
            var endIndex =
                typeof end === 'number' ? end : this.getElementIndex(end, allOptions);

            for (var index = 0; index < allOptions.length; index++) {
                var selected = this.checkInRange(index, startIndex, endIndex);
                allOptions[index].setAttribute('aria-selected', selected + '');
            }

            this.updateMoveButton();
        };

        /**
         * Check for selected options and update moveButton, if applicable
         */
        aria.Listbox.prototype.updateMoveButton = function() {
            if (!this.moveButton) {
                return;
            }

            if (this.listboxNode.querySelector('[aria-selected="true"]')) {
                this.moveButton.setAttribute('aria-disabled', 'false');
            } else {
                this.moveButton.setAttribute('aria-disabled', 'true');
            }
        };

        /**
         * Check if the selected option is in view, and scroll if not
         */
        aria.Listbox.prototype.updateScroll = function() {
            var selectedOption = document.getElementById(this.activeDescendant);
            if (
                selectedOption &&
                this.listboxNode.scrollHeight > this.listboxNode.clientHeight
            ) {
                var scrollBottom =
                    this.listboxNode.clientHeight + this.listboxNode.scrollTop;
                var elementBottom = selectedOption.offsetTop + selectedOption.offsetHeight;
                if (elementBottom > scrollBottom) {
                    this.listboxNode.scrollTop =
                        elementBottom - this.listboxNode.clientHeight;
                } else if (selectedOption.offsetTop < this.listboxNode.scrollTop) {
                    this.listboxNode.scrollTop = selectedOption.offsetTop;
                }
            }
        };

        /**
         * @description
         *  Enable/disable the up/down arrows based on the activeDescendant.
         */
        aria.Listbox.prototype.checkUpDownButtons = function() {
            var activeElement = document.getElementById(this.activeDescendant);

            if (!this.moveUpDownEnabled) {
                return;
            }

            if (!activeElement) {
                this.upButton.setAttribute('aria-disabled', 'true');
                this.downButton.setAttribute('aria-disabled', 'true');
                return;
            }

            if (this.upButton) {
                if (activeElement.previousElementSibling) {
                    this.upButton.setAttribute('aria-disabled', false);
                } else {
                    this.upButton.setAttribute('aria-disabled', 'true');
                }
            }

            if (this.downButton) {
                if (activeElement.nextElementSibling) {
                    this.downButton.setAttribute('aria-disabled', false);
                } else {
                    this.downButton.setAttribute('aria-disabled', 'true');
                }
            }
        };

        /**
         * @description
         *  Add the specified items to the listbox. Assumes items are valid options.
         * @param items
         *  An array of items to add to the listbox
         */
        aria.Listbox.prototype.addItems = function(items) {
            if (!items || !items.length) {
                return;
            }

            items.forEach(
                function(item) {
                    this.defocusItem(item);
                    this.toggleSelectItem(item);
                    this.listboxNode.append(item);
                }.bind(this)
            );

            if (!this.activeDescendant) {
                this.focusItem(items[0]);
            }

            this.handleItemChange('added', items);
        };

        /**
         * @description
         *  Remove all of the selected items from the listbox; Removes the focused items
         *  in a single select listbox and the items with aria-selected in a multi
         *  select listbox.
         * @returns {Array}
         *  An array of items that were removed from the listbox
         */
        aria.Listbox.prototype.deleteItems = function() {
            var itemsToDelete;

            if (this.multiselectable) {
                itemsToDelete = this.listboxNode.querySelectorAll('[aria-selected="true"]');
            } else if (this.activeDescendant) {
                itemsToDelete = [document.getElementById(this.activeDescendant)];
            }

            if (!itemsToDelete || !itemsToDelete.length) {
                return [];
            }

            itemsToDelete.forEach(
                function(item) {
                    item.remove();

                    if (item.id === this.activeDescendant) {
                        this.clearActiveDescendant();
                    }
                }.bind(this)
            );

            this.handleItemChange('removed', itemsToDelete);

            return itemsToDelete;
        };

        aria.Listbox.prototype.clearActiveDescendant = function() {
            this.activeDescendant = null;
            this.listboxNode.setAttribute('aria-activedescendant', null);

            this.updateMoveButton();
            this.checkUpDownButtons();
        };




        /**
         * @description
         *  Delete the currently selected items and add them to the sibling list.
         */
        aria.Listbox.prototype.moveItems = function() {
            if (!this.siblingList) {
                return;
            }

            var itemsToMove = this.deleteItems();
            this.siblingList.addItems(itemsToMove);
        };


        /**
         * @description
         *  Enable Move controls. Moving removes selected items from the current
         *  list and adds them to the sibling list.
         * @param button
         *   Move button to trigger delete
         * @param siblingList
         *   Listbox to move items to
         */
        aria.Listbox.prototype.setupMove = function(button, siblingList) {
            this.siblingList = siblingList;
            this.moveButton = button;
            button.addEventListener('click', this.moveItems.bind(this));
        };
    </script>

</body>

</html>