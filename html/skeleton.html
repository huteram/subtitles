<!DOCTYPE html>
<html lang="en">

<head>
    <title>Learn Languages from Subtitles</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="mini-default.css">

</head>

<body>



    <header class="sticky row">
        <div class="col-sm-12 col-md-12 col-lg-10 col-lg-offset-1">
            <img src="mh.png" alt="logo" style="width: 50px; float: left; border-radius: 50%;">
            <h1>&nbsp;Learn Languages from Subtitles</h1>
        </div>
    </header>
    <!--  The container of the grid system and all of the content appears below.  -->
    <div class="container">
        <!-- Video -->
        <div class="row">
            <div class="col-sm-12 col-md-10 col-lg-6 col-md-offset-1 col-lg-offset-3">

                <video id="myvideo" width="500px" ; class="center">
                    <source src="..\\avi\\Man.On.The.Moon.mp4">
                    <p>Your browser does not support this video format.</p>
                  </video>
                <p></p>
                <button onclick="settime()">Play video!</button>
                <button onclick="stopFilm()">Stop!</button>
                <button onclick="selectRandomWord()">Random selection</button>
                <input type="file" id="videoFile" name="videoFile" accept="video/*">
                <div id="CZSentence">CZSentence</div>
            </div>
        </div>
        <!-- Listboxes -->

        <div class="row">
            <div class="col-sm-12 col-md-3 col-lg-2 col-md-first col-sm-last">
                <h2>Words</h2>
                <select id="select_word_en" size="10" style="width:100%" onclick="selecteItem()">
					<!-- will be filling by JS -->
					<option value="1" role="word" word_selected="false" class="" ">hello</option>
					<option value="2" role="word" word_selected="false" class="" ">i</option>
					<option value="3" role="word" word_selected="false" class="" ">am</option>
					<option value="4" role="word" word_selected="false" class="" ">andy</option>
					<option value="5" role="word" word_selected="false" class="" ">and</option>
				</select>
            </div>

            <div class="col-sm-12 col-md-9 col-lg-10">
                <h2>Sentences</h2>
                <select id="select_sentence_en" role="listbox" size="10" style="width:100%" onclick="selecteSentence()">
					<!-- will be filling by JS -->
					<option value="1" role="word" word_selected="false" IdElement="1" class="" ">Hello.</option>
					<option value="2" role="word" word_selected="false" IdElement="2" class="" ">I am Andy...</option>
					<option value="3" role="word" word_selected="false" IdElement="3" class="" ">and I would like to thank you for coming to my movie.</option>
					<option value="4" role="word" word_selected="false" IdElement="4" class="" ">I wish it was better, you know,</option>
					<option value="5" role="word" word_selected="false" IdElement="5" class="" ">but... it is so stupid.</option>

				</select>
            </div>
        </div>
    </div>

    <!--  The footer is pretty simple to make, too!  -->
    <footer class="row">
        <div class="col-sm-12 col-md-12 col-lg-10 col-lg-offset-1">
            <p>
                <smal>&copy;2022 Milan Hutera</small>
            </p>
        </div>
    </footer>

    <script type="text/javascript">
        var optSentences = document.getElementById("select_sentence_en");
        var lastWord = "";
        var TimeSelector = {
            Start: 0,
            Stop: 10,
        }
        const czSentences = {
            1: {
                Id: 1,
                Text: 'INTERSONIC UVÁDÍ',
                Start: 5.906,
                Stop: 11.061,
                Words: [1, 2],
                EN_Id: [0],
                Duration: 5155.0
            },
            2: {
                Id: 2,
                Text: 'Dobrý den. Já jsem Andy.',
                Start: 45.406,
                Stop: 49.898,
                Words: [3, 4, 5, 6, 7],
                EN_Id: [1, 2],
                Duration: 4492.000000000005
            },
            3: {
                Id: 3,
                Text: 'Děkuju vám, že jste přišli na můj film.',
                Start: 50.906,
                Stop: 54.485,
                Words: [8, 9, 10, 11, 12, 13, 14, 15],
                EN_Id: [3],
                Duration: 3579.0000000000005
            },
            4: {
                Id: 4,
                Text: 'Škoda, že není lepší. To víte...',
                Start: 56.281,
                Stop: 60.819,
                Words: [16, 10, 17, 18, 19, 20],
                EN_Id: [4],
                Duration: 4538.000000000004
            },
            5: {
                Id: 5,
                Text: 'Je stupidní. Je hroznej. Vůbec se mi nelíbí.',
                Start: 62.364,
                Stop: 66.938,
                Words: [21, 22, 23, 24, 25, 26, 27],
                EN_Id: [5, 6],
                Duration: 4574.0000000000055
            }
        };
        const czWords = {
            1: {
                Id: 1,
                Word: 'intersonic',
                count: '1',
                sentence: [1]
            },
            2: {
                Id: 2,
                Word: 'uvÁdÍ',
                count: '1',
                sentence: [1]
            },
            3: {
                Id: 3,
                Word: 'dobrý',
                count: '5',
                sentence: [2, 88, 162, 371, 830]
            },
            4: {
                Id: 4,
                Word: 'den',
                count: '5',
                sentence: [2, 88, 395, 706, 948]
            },
            5: {
                Id: 5,
                Word: 'já',
                count: '42',
                sentence: [2, 20, 59, 82, 159, 165, 170, 172, 220, 225, 249, 250, 285, 326, 337, 343, 352, 383, 393, 419, 436, 442, 460, 513, 520, 550, 552, 564, 575, 607, 612, 627, 700, 739, 741, 795, 796, 797, 934, 986, 990, 991]
            }
        };
        const enSentences = {
            1: {
                Id: 1,
                Text: 'Hello.',
                Start: 45.667,
                Stop: 47.833,
                Words: [1],
                6: '',
                CZ_Id: [2],
                Duration: 2165.999999999997,
                selected: false
            },
            2: {
                Id: 2,
                Text: 'I am Andy...',
                Start: 47.958,
                Stop: 50.958,
                Words: [2, 3, 4],
                6: '',
                CZ_Id: [2],
                Duration: 3000.0,
                selected: false
            },
            3: {
                Id: 3,
                Text: 'and I would like to thank you for coming to my movie.',
                Start: 51.083,
                Stop: 54.75,
                Words: [5, 2, 6, 7, 8, 9, 10, 11, 12, 13, 14],
                6: '',
                CZ_Id: [3],
                Duration: 3667.000000000002,
                selected: false
            },
            4: {
                Id: 4,
                Text: 'I wish it was better, you know,',
                Start: 56.5,
                Stop: 60.542,
                Words: [2, 15, 16, 17, 18, 10, 19],
                6: '',
                CZ_Id: [4],
                Duration: 4042.000000000002,
                selected: false
            },
            5: {
                Id: 5,
                Text: 'but... it is so stupid.',
                Start: 60.625,
                Stop: 63.958,
                Words: [20, 16, 21, 22, 23],
                6: '',
                CZ_Id: [5],
                Duration: 3332.999999999998,
                selected: false
            }
        };
        const enWords = {
            1: {
                Id: 1,
                Word: 'hello',
                count: '6',
                sentence: [1, 3],
                selectedSentence: {},
                selected: false
            },
            2: {
                Id: 2,
                Word: 'i',
                count: '417',
                sentence: [2],
                selectedSentence: {},
                selected: false
            },
            3: {
                Id: 3,
                Word: 'am',
                count: '22',
                sentence: [2, 4],
                selectedSentence: {},
                selected: false
            },
            4: {
                Id: 4,
                Word: 'andy',
                count: '99',
                sentence: [3, 5],
                selectedSentence: {},
                selected: false
            },
            5: {
                Id: 5,
                Word: 'and',
                count: '184',
                sentence: [3],
                selectedSentence: {},
                selected: false
            }
        };


        var aria = aria || {};
        var word = {};
        var wordList = [];
        var sentenceList = {};
        var selectedWord = {};
        aria.Listbox = function(listboxNode) {
            this.listboxNode = listboxNode;

        };


        const input = document.querySelector('input');
        input.addEventListener('change', updateImageDisplay);

        function updateImageDisplay() {
            const curFiles = input.files;
            const VideoElement = document.getElementById("myvideo");
            for (const file of curFiles) {
                VideoElement.src = URL.createObjectURL(file);
            }

        }

        function stopFilm() {
            var video = document.getElementById("myvideo");
            video.pause();
        }

        function settime() {
            var video = document.getElementById("myvideo");
            var Duration = (TimeSelector.Stop - TimeSelector.Start) * 1000
            video.currentTime = TimeSelector.Start;
            video.play();
            console.log(video.currentTime);
            setInterval(function() {

                if (video.currentTime > TimeSelector.Stop) {

                    video.pause();
                }
            }, Duration);
        }


        function showSelectedSentences(sentenceList) {
            var valueCounter = 1;
            for (element of sentenceList) {
                var sentenceAdding = enSentences[element];
                if (sentenceAdding.selected == true) {
                    var opt = document.createElement("option");
                    opt.text = sentenceAdding.Text
                    opt.role = "word";
                    opt.IdElement = sentenceAdding.Id;
                    opt.word_selected = sentenceAdding.selected;
                    opt.value = valueCounter;
                    valueCounter += 1;
                    optSentences.options.add(opt);
                };

            };
            if (valueCounter == 1) {
                showSentences(sentenceList)
            };
        }

        function showSentences(sentenceList) {
            for (element of sentenceList) {
                var sentenceAdding = enSentences[element];
                var opt = document.createElement("option");
                opt.text = sentenceAdding.Text;
                opt.role = "word";
                opt.IdElement = sentenceAdding.Id;
                opt.word_selected = sentenceAdding.selected;
                opt.value = valueCounter;
                valueCounter += 1;
                optSentences.options.add(opt);
            }

        }

        function selectRandomSentence() {
            var selectSen = document.getElementById('select_sentence_en');
            var index = Math.floor(Math.random() * (selectSen.length - 1));
            // random sentence
            var valuesSen = Object.values(enSentences);
            var IdElement = selectSen.options[index]
            var selectedSentence = enSentences[IdElement.value]
            var czText = ""
            var czTextPart = ""
            TimeSelector.Start = 999999999999999
            TimeSelector.Stop = 0
            for (element of selectedSentence.CZ_Id) {
                czTextPart = czSentences[element]
                czText += czTextPart.Text + " "
                TimeSelector.Stop = Math.max(czSentences[element].Stop, TimeSelector.Stop)
                TimeSelector.Start = Math.min(czSentences[element].Start, TimeSelector.Start)
            }
            TimeSelector.Stop = selectedSentence.Stop;
            TimeSelector.Start = selectedSentence.Start;

            CZSentence.innerHTML = czText;
            selectSen.selectedIndex = index;
            settime();

        }

        function selectRandomWord() {
            if (Object.keys(word).length == 0) {
                selectRandomSentence()
            } else {
                var select = document.getElementById('select_word_en');
                var index = Math.floor(Math.random() * word.length);
                const values = Object.values(word);
                const randomValue = values[parseInt(Math.random() * values.length)];
                var selectedWord = enWords[randomValue.index + 1];

                select.selectedIndex = randomValue.index;

                // clear senetnecs box
                var optDefault = optSentences.options[0]
                while (optSentences.childElementCount > 0) {
                    optSentences.options.remove(0);
                }
                // add sentences 
                showSelectedSentences(selectedWord.sentence)
                index = Math.floor(Math.random() * (valueCounter - 1));

                // random sentence
                var valuesSen = Object.values(enSentences);
                var selectSen = document.getElementById('select_sentence_en');
                var IdElement = selectSen.options[index]
                var selectedSentence = enSentences[IdElement.IdElement]
                var CzSentence = document.getElementById("CZSentence");
                var czText = ""
                var czTextPart = ""
                TimeSelector.Start = 999999999999999
                TimeSelector.Stop = 0
                for (element of selectedSentence.CZ_Id) {
                    czTextPart = czSentences[element]
                    czText += czTextPart.Text + " "
                    TimeSelector.Stop = Math.max(czSentences[element].Stop, TimeSelector.Stop)
                    TimeSelector.Start = Math.min(czSentences[element].Start, TimeSelector.Start)
                }
                TimeSelector.Stop = selectedSentence.Stop;
                TimeSelector.Start = selectedSentence.Start;

                CZSentence.innerHTML = czText;
                selectSen.selectedIndex = index;
                settime();

            }

        }


        function displayDate() {
            document.getElementById("demo").innerHTML = Date();
        }

        function selecteSentence() {
            var selObj = document.getElementById("select_sentence_en");
            aria.id = document.getElementById("select_sentence_en").value;

            var idElement = parseInt(aria.id);
            var selectedIdElement = idElement - 1;
            var word_selected = selObj[selectedIdElement].getAttribute("word_selected");
            var sentenceId = selObj[selectedIdElement].getAttribute("idElement");
            var selectedSentence = enSentences[sentenceId]

            if (word_selected == 'true') {
                selObj[selectedIdElement].setAttribute("word_selected", "false");
                delete sentenceList[idElement];
                selectedSentence.selected = false;

            } else {
                selObj[selectedIdElement].setAttribute("word_selected", "true");
                sentenceList[idElement] = selectedSentence;
                selectedSentence.selected = true;
            }

        }

        function selecteItem() {

            var selObj = document.getElementById("select_word_en");
            aria.id = document.getElementById("select_word_en").value;
            var idElement = parseInt(aria.id);
            var selectedIdElement = idElement - 1;
            var word_selected = selObj[selectedIdElement].getAttribute("word_selected");
            selectedWord = enWords[idElement]

            // clear senetnecs box
            var optDefault = optSentences.options[0]
            while (optSentences.childElementCount > 0) {
                optSentences.options.remove(0);
            }

            // add sentences 
            valueCounter = 1;
            for (element of selectedWord.sentence) {
                var sentenceAdding = enSentences[element];
                var opt = document.createElement("option");
                opt.text = sentenceAdding.Text
                opt.setAttribute("role", "word");
                opt.setAttribute("word_selected", sentenceAdding.selected);
                opt.setAttribute("IdElement", sentenceAdding.Id);
                opt.setAttribute("value", valueCounter);
                valueCounter += 1;
                optSentences.options.add(opt);
            };

            if (lastWord != selectedWord.Word) {
                lastWord = selectedWord.Word
            } else {
                if (word_selected == 'true') {
                    selObj[selectedIdElement].setAttribute("word_selected", "false");
                    delete word[selectedIdElement];
                    selectedWord.selected = false;
                } else {
                    selObj[selectedIdElement].setAttribute("word_selected", "true");
                    word[selectedIdElement] = selObj[selectedIdElement];
                    selectedWord.selected = true;
                }
            }




            //document.getElementById("select_sentence_en").options.add(selObj[aria.id]);  
            return true;
        }
    </script>

</body>

</html>